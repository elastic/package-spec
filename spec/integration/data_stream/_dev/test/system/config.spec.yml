##
## Describes the specification for a system test configuration file
##
spec:
  # Everything under here follows JSON schema (https://json-schema.org/), written as YAML for readability
  type: object
  additionalProperties: true
  properties:
    skip:
      $ref: "./../skip.spec.yml#/definitions/skip"
    wait_for_data_timeout:
      description: Timeout for waiting for metrics data during a system test.
      type: string
      example: 10m
    agent:
      description: "Configuration overrides for the Elastic Agent"
      type: object
      additionalProperties: false
      properties:
        user:
          description: "User that runs Elastic Agent process"
          type: string
          example: root
          default: ""
        pid_mode:
          description: >
            (From docker-compose docs) Turns on sharing between container and the host
            operating system the PID address space
          type: string
          enum:
            - host
        capabilities:
          description: "Capabilities that must have the system to run Elastic Agent process"
          type: array
          items:
            type: string
            description: Capability name
            # https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities
            enum:
              - AUDIT_CONTROL
              - AUDIT_READ
              - AUDIT_WRITE
              - BLOCK_SUSPEND
              - BPF
              - CHECKPOINT_RESTORE
              - CHOWN
              - DAC_OVERRIDE
              - DAC_READ_SEARCH
              - FOWNER
              - FSETID
              - IPC_LOCK
              - IPC_OWNER
              - KILL
              - LEASE
              - LINUX_IMMUTABLE
              - MAC_ADMIN
              - MAC_OVERRIDE
              - MKNOD
              - NET_ADMIN
              - NET_BIND_SERVICE
              - NET_BROADCAST
              - NET_RAW
              - PERFORM
              - SETFCAP
              - SETGID
              - SETPCAP
              - SETUID
              - SYS_ADMIN
              - SYS_BOOT
              - SYS_CHROOT
              - SYS_MODULE
              - SYS_NICE
              - SYS_PACCT
              - SYS_PTRACE
              - SYS_RAWIO
              - SYS_RESOURCE
              - SYS_TIME
              - SYS_TTY_CONFIG
              - SYSLOG
              - WAKE_ALARM
            examples:
              - AUDIT_CONTROL
              - AUDIT_READ
        runtime:
          description: "Runtime to run Elastic Agent"
          type: string
          enum:
            - docker
      required:
        - runtime
