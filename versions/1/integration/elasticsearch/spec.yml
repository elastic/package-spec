spec:
  additionalContents: false
  contents:
    - description: Folder containing ML model assets
      type: folder
      name: ml_model
      required: false
      contents:
        - description: An ML model file
          type: file
          contentMediaType: "application/json"
          pattern: '^{PACKAGE_NAME}_.+\.json$'
    - description: Folder containing Elasticsearch Ingest Node pipeline definitions
      type: folder
      name: ingest_pipeline
      additionalContents: true
      contents:
        - description: Supporting ingest pipeline definitions in YAML
          type: file
          sizeLimit: 3MB
          pattern: '^.+\.yml$'
          # TODO Determine if special handling of `---` is required (issue: https://github.com/elastic/package-spec/pull/54)
          contentMediaType: "application/x-yaml; require-document-dashes=true"
          required: false
        - description: Supporting ingest pipeline definitions in JSON
          type: file
          sizeLimit: 3MB
          pattern: '^.+\.json$'
          contentMediaType: "application/json"
          required: false
    - description: Folder containing Elasticsearch Transforms
      # https://www.elastic.co/guide/en/elasticsearch/reference/current/transforms.html
      type: folder
      name: transform
      required: false
      contents:
        - description: |-
            An Elasticsearch transform folder.
            Upon installation of a package that contains a transform asset, the create behavior is as follows:
            1. If a destination index template is included:
              1. Create the destination index template.
              2. Add the appropriate _meta fields to mark the matching indices as managed by Fleet.
              3. If a fields directory is included:
                1. Use the defined fields as the destination index template mappings.
              4. if the destination index doesn't already exist:
                1. Initialize the index.
            2. Create the transform in the default namespace using kibana_system privileges.
            3. If the transform is configured to be started upon installation (no configuration defaults to true):
              1. Start the transform.

            Upon upgrading a package that contains a transform asset, the upgrade behavior is as follows:
            1. If a destination index template is included:
              1. Delete the destination index template.
              2. Matching indices are not deleted.
            2. If the transform is started:
              1. Stop the transform.
            3. Delete the transform.
            4. From here, follow the creation behavior.
          type: folder
          pattern: '^[a-z0-9_]+$'
          contents:
            - description: Elasticsearch transform file
              type: file
              required: true
              contentMediaType: "application/x-yaml"
              pattern: '^transform\.yml$'
            - description: A transform's manifest file
              type: file
              contentMediaType: "application/x-yaml"
              sizeLimit: 5MB
              name: "manifest.yml"
              required: false
              $ref: "./transform/manifest.spec.yml"
            - description: Folder containing field definitions to be used as the mappings for the index template
              type: folder
              name: fields
              required: false
              $ref: "../data_stream/fields/spec.yml"
