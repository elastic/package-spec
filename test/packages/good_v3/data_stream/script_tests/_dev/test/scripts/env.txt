[!exec:echo] skip 'Skipping test requiring absent echo command'

exec echo ${PKG}
stdout '^with_script$'

exec echo ${PKG_ROOT}
stdout 'github\.com/elastic/elastic-package/test/packages/other/with_script$'

exec echo ${DATA_STREAM}
stdout '^first$'

exec echo ${DATA_STREAM_ROOT}
stdout 'github\.com/elastic/elastic-package/test/packages/other/with_script/data_stream/first$'

exec echo ${CURRENT_VERSION}
stdout '^0\.0\.2$'

exec echo ${PREVIOUS_VERSION}
stdout '^0\.0\.1$'

exec echo ${FIELDS_QUERY}
cmp stdout want_query.text

-- want_query.text --
{
  "fields": [
    "*"
  ],
  "runtime_mappings": {
    "my_ignored": {
      "type": "keyword",
      "script": {
        "source": "for (def v : params['_fields']._ignored.values) { emit(v); }"
      }
    }
  },
  "aggs": {
    "all_ignored": {
      "filter": {
        "exists": {
          "field": "_ignored"
        }
      },
      "aggs": {
        "ignored_fields": {
          "terms": {
            "size": 100,
            "field": "my_ignored"
          }
        },
        "ignored_docs": {
          "top_hits": {
            "size": 5
          }
        }
      }
    }
  }
}
