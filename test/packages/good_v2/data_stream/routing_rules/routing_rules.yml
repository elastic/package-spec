routing_rules:
  # "Local" routing rules are included under this current dataset, not a special case
  - name: nginx
    rules: # Route error logs to `nginx.error` when they're sourced from an error logfile
    - dataset: nginx.error
      if: "ctx?.file?.path?.contains('/var/log/nginx/error')"
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default

    # Route access logs to `nginx.access` when they're sourced from an access logfile
    - dataset: nginx.access
      if: "ctx?.file?.path?.contains('/var/log/nginx/access')"
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default

  # Route K8's container logs to this catch-all dataset for further routing
  - name: k8s.router
    rules:
    - dataset: nginx
      if: "ctx?.container?.image?.name == 'nginx'"
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default

  # Route syslog entries tagged with nginx to this catch-all dataset
  - name: syslog
    rules:
    - dataset: nginx
      if: "ctx?.tags?.contains('nginx')"
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default
