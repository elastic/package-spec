format_version: 3.6.0
name: good_var_groups
title: Good Var Groups Package
description: This package demonstrates valid var_groups usage for conditional variable groups.
version: 1.0.0-next
type: integration
source:
  license: "Apache-2.0"
conditions:
  kibana:
    version: '^8.10.0'
  elastic:
    subscription: 'basic'
  agent:
    version: '^9.1.0'
vars:
  - name: access_key_id
    type: text
    title: Access Key ID
    show_user: true
    secret: false
  - name: secret_access_key
    type: password
    title: Secret Access Key
    show_user: true
    secret: true
  - name: session_token
    type: password
    title: Session Token
    show_user: true
    secret: true
  - name: role_arn
    type: text
    title: Role ARN
    show_user: true
  - name: external_id
    type: password
    title: External ID
    show_user: true
    secret: true
var_groups:
  - name: credential_type
    title: Setup Access
    selector_title: Preferred method
    description: >
      Utilize AWS Access Keys or assume role to set up access
      for assessing your AWS environment's security posture.
    required: true  # User MUST select an authentication method
    options:
      - name: direct_access_key
        title: Direct Access Keys
        description: Use AWS access key ID and secret access key directly.
        vars:
          - access_key_id
          - secret_access_key

      - name: temporary_access_key
        title: Temporary Access Keys
        description: Use temporary credentials with session token.
        vars:
          - access_key_id
          - secret_access_key
          - session_token

      - name: cloud_connectors
        title: Cloud Connector (recommended)
        description: Use Elastic Cloud Connector for secure, agentless authentication.
        vars:
          - role_arn
          - external_id
        hide_in_deployment_modes:
          - default
        # Cloud Connector-specific extensions (allowed by additionalProperties: true)
        provider: aws
        iac_template_url: "https://console.aws.amazon.com/cloudformation/home#/stacks/quickcreate?templateURL=https://elastic-cloud-connectors.s3.amazonaws.com/cloudformation-aws-connector.yml&stackName=Elastic-Cloud-Connector"

      - name: assume_role
        title: Assume Role
        description: Assume an IAM role using role ARN.
        vars:
          - role_arn
        hide_in_deployment_modes:
          - agentless
policy_templates:
  - name: sample
    title: Sample logs and metrics
    description: Collect sample logs and metrics
    data_streams:
      - findings
    inputs:
      - type: httpjson
        title: Collect via API
        description: Collecting data from HTTP JSON API
        multi: false
        vars:
          - name: url
            type: url
            title: API URL
            show_user: true
            required: true
      - type: aws-s3
        title: Collect from S3
        description: Collecting logs from AWS S3 bucket
        multi: false
        # Hide cloud_connectors option for this input (aws-s3 doesn't support it)
        hide_in_var_group_options:
          credential_type:
            - cloud_connectors
        vars:
          - name: bucket_name
            type: text
            title: S3 Bucket Name
            show_user: true
            required: true
owner:
  github: elastic/ecosystem
  type: elastic
screenshots:
  - src: /img/sample-screenshot.png
    title: Sample screenshot
    size: 600x600
    type: image/png
icons:
  - src: /img/sample-logo.svg
    title: Sample logo
    size: 32x32
    type: image/svg+xml
